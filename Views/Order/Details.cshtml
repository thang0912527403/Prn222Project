@model Prn222Project.Models.Orders
@using System.Globalization
@{
    ViewData["Title"] = $"Đơn hàng #{Model.order_id}";
    decimal total = Model.OrderDetails.Sum(i => i.unit_price * i.quantity);
    string VND(decimal v) => v.ToString("N0", new CultureInfo("vi-VN"));

    string StatusBadge(string status)
    {
        status = (status ?? "").Trim().ToLower();
        return status switch
        {
            "pending" => "bg-amber-50 text-amber-700 ring-1 ring-amber-200",
            "paid" => "bg-blue-50 text-blue-700 ring-1 ring-blue-200",
            "shipping" => "bg-purple-50 text-purple-700 ring-1 ring-purple-200",
            "completed" => "bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200",
            "canceled" => "bg-rose-50 text-rose-700 ring-1 ring-rose-200",
            _ => "bg-gray-50 text-gray-700 ring-1 ring-gray-200"
        };
    }
}

<div class="container max-w-6xl mx-auto px-4 lg:px-8 py-10 text-gray-900">
    <div class="flex items-center justify-between mb-6">
        <div>
            <br/>
            <a href="@Url.Action("Index", "Order")" class="text-sm text-gray-500 hover:text-gray-700">&larr; Quay lại</a>
            <h1 class="mt-1 text-3xl font-extrabold tracking-tight text-theme">Đơn hàng #@Model.order_id</h1>
            <p class="text-gray-500 mt-1">Đặt lúc @Model.order_date.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</p>
        </div>
    </div>

    <div class="grid lg:grid-cols-3 gap-6">
        <!-- Items -->
        <section class="lg:col-span-2 bg-white border border-gray-200 rounded-2xl shadow-sm overflow-hidden">
            <div class="px-5 py-4 border-b border-gray-200 flex items-center justify-between">
                <h2 class="font-semibold">Sản phẩm</h2>
            </div>

            <ul class="divide-y divide-gray-100">
                @foreach (var i in Model.OrderDetails)
                {
                    var pv = i.ProductVariant;
                    var product = pv?.Product;
                    var name = product?.Name ?? ("Variant #" + i.productVariant_id);
                    var variant = string.Join(" / ", new[] { pv?.Color, pv?.Size, pv?.Decoration }.Where(s => !string.IsNullOrWhiteSpace(s)));
                    var image = string.IsNullOrWhiteSpace(product?.ImageUrl) ? "/images/no-image.jpg" : product.ImageUrl;

                    <li class="px-5 py-4 hover:bg-gray-50 transition">
                        <div class="flex items-center gap-4">
                            <img src="@image" alt="@name" class="w-16 h-16 rounded-xl object-cover border border-gray-200" />
                            <div class="flex-1 min-w-0">
                                <div class="font-medium truncate">@name</div>
                                <div class="text-xs text-gray-500 mt-0.5">@variant</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-700">@VND(i.unit_price) ₫</div>
                                <div class="text-sm text-gray-700">x @i.quantity</div>
                                <div class="mt-1 font-semibold">@VND(i.unit_price * i.quantity) ₫</div>
                            </div>
                        </div>
                    </li>
                }
            </ul>

            <div class="px-5 py-4 border-t border-gray-200 flex items-center justify-end gap-6 bg-gray-50">
                <div class="text-sm text-gray-600">Tạm tính</div>
                <div class="text-xl font-extrabold">@VND(total) ₫</div>
            </div>
        </section>

        <!-- Meta / Shipping -->
        <aside class="space-y-6">
            <div class="bg-white border border-gray-200 rounded-2xl shadow-sm">
                <div class="px-5 py-4 border-b border-gray-200">
                    <h2 class="font-semibold">Thông tin đơn</h2>
                </div>
                <div class="px-5 py-4 text-sm space-y-3">
                    <div class="flex justify-between"><span class="text-gray-500">Mã đơn</span><span class="font-medium">#@Model.order_id</span></div>
                    <div class="flex justify-between"><span class="text-gray-500">Ngày đặt</span><span>@Model.order_date.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</span></div>
                    @* Nếu có thêm PaymentMethod/PaidAt/TrackingNumber: render ở đây *@
                </div>
            </div>

            @* Nếu bạn có lưu địa chỉ/điện thoại trong Orders thì thêm card này
            <div class="bg-white border border-gray-200 rounded-2xl shadow-sm">
                <div class="px-5 py-4 border-b border-gray-200">
                    <h2 class="font-semibold">Giao hàng</h2>
                </div>
                <div class="px-5 py-4 text-sm space-y-2">
                    <div><span class="text-gray-500">Người nhận:</span> <span class="font-medium">...</span></div>
                    <div><span class="text-gray-500">SĐT:</span> <span class="font-medium">...</span></div>
                    <div><span class="text-gray-500">Địa chỉ:</span> <span class="font-medium">...</span></div>
                </div>
            </div>
            *@
        </aside>
    </div>
</div>
