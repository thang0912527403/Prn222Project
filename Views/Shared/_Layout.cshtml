@using Prn222Project.ViewModels;
@using System.Text.Json;
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    @* <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" /> *@
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Prn222Project.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/tailwind.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/theme.css" asp-append-version="true" />
    <link href="~/lib/font-awesome/css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    @await RenderSectionAsync("Scripts", required: false)

</head>
<body class="theme-bg">
    <header class="sticky top-0 z-50 border-b theme-line">
        <nav class="theme-card transition-colors duration-300">
            <div class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">
                <div class="relative flex h-16 items-center justify-between">
                    <!-- Brand + menu -->
                    <div class="flex flex-1 items-center justify-center sm:items-stretch sm:justify-start">
                        <a href="/" class="font-decorative text-xl theme-text">HandWooven</a>
                        <div class="hidden sm:ml-6 sm:block">
                            <div class="flex space-x-4">
                                <a href="/products" class="rounded-md px-3 py-2 text-sm font-medium hover:bg-black/5">Sản phẩm</a>
                                @* <a href="/news" class="rounded-md px-3 py-2 text-sm font-medium hover:bg-black/5">Tin tức</a> *@
                                <a href="/about-us" class="rounded-md px-3 py-2 text-sm font-medium hover:bg-black/5">Về chúng tôi</a>
                                @* <a href="/contact" class="rounded-md px-3 py-2 text-sm font-medium hover:bg-black/5">Liên hệ</a> *@
                            </div>
                        </div>
                    </div>

                    <!-- Search -->
                    <form method="get" asp-controller="Product" asp-action="Index"
                          class="hidden lg:flex items-center rounded-md theme-card pl-3 outline-1 -outline-offset-1 theme-line">
                        <div class="shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M11 4a7 7 0 1 1-7 7 7 7 0 0 1 7-7zM22 22l-5.5-5.5" />
                            </svg>
                        </div>
                        <input type="text" name="search" class="block min-w-0 grow py-1.5 pr-3 pl-2 text-base theme-text placeholder:text-gray-400 focus:outline-none sm:text-sm"
                               placeholder="Tìm kiếm" />
                        <button class="px-3 py-1.5 text-sm rounded-r-md btn-primary">Tìm</button>
                    </form>

                    <div class="ml-3 flex items-center gap-3">
                        <button id="toggleDark" type="button"
                                class="size-8 rounded-full theme-card p-1 theme-text hover:opacity-80 focus:ring-2 focus:ring-white focus:outline-hidden">
                            <i class="fa-solid fa-circle-half-stroke text-lg"></i>
                        </button>

                        <button type="button" class="size-8 rounded-full theme-card p-1 theme-text hover:opacity-80">
                            <i class="fa-regular fa-bell text-lg"></i>
                        </button>

                        @if (!User.Identity.IsAuthenticated)
                        {
                            <a type="button" class="relative size-8 rounded-full bg-white dark:bg-gray-800 dark:hover:text-black p-1 text-black dark:text-white hover:text-gray-400 focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-800 focus:outline-hidden cursor-pointer" onclick="openModal()">
                                <span class="absolute -inset-1.5"></span>
                                <span class="sr-only">Login</span>
                                <i class="fa-solid fa-right-to-bracket"></i>
                            </a>
                        }
                        else
                        {
                            <button id="userButton" type="button" class="relative size-8 rounded-full bg-white dark:bg-gray-800 dark:hover:text-black p-1 text-black dark:text-white hover:text-gray-400 focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-800 focus:outline-hidden cursor-pointer">
                                <span class="absolute -inset-1.5"></span>
                                <span class="sr-only">User menu</span>
                                <i class="fa-solid fa-user-tie"></i>
                            </button>
                            <!-- Popover -->
                            <div id="popover" class="popover-arrow absolute right-0 mt-2 w-64 bg-gray-800 border border-gray-700 rounded-lg shadow-lg opacity-0 invisible transform scale-95 transition-all duration-200 z-10" style="top: 100%;">
                                <div class="p-4">
                                    <div class="flex items-center space-x-3 mb-3">
                                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                            <i class="fa-solid fa-user text-white text-sm"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-white">Thang</h3>
                                            <p class="text-sm text-gray-400">Administrator</p>
                                        </div>
                                    </div>
                                    <div class="border-t border-gray-700 pt-3">
                                        <ul class="space-y-1">
                                            <li><a href="#" class="flex items-center space-x-3 px-2 py-2 text-sm text-gray-300 hover:bg-gray-700 rounded-md transition-colors"><i class="fa-solid fa-user-circle w-4 h-4"></i><span>Profile</span></a></li>
                                            <li><a href="/Product/Cart" class="flex items-center space-x-3 px-2 py-2 text-sm text-gray-300 hover:bg-gray-700 rounded-md transition-colors"><i class="fa-solid fa-user-circle w-4 h-4"></i><span>Cart</span></a></li>
                                            <li><a href="#" class="flex items-center space-x-3 px-2 py-2 text-sm text-gray-300 hover:bg-gray-700 rounded-md transition-colors"><i class="fa-solid fa-cog w-4 h-4"></i><span>Settings</span></a></li>
                                            <li class="border-t border-gray-700 pt-1">
                                                <form method="post" asp-area="Identity" asp-page="/Account/Logout" class="inline">
                                                    <button type="submit" class="w-full flex items-center space-x-3 px-2 py-2 text-sm text-red-400 hover:bg-red-900/20 rounded-md transition-colors">
                                                        <i class="fa-solid fa-sign-out-alt w-4 h-4"></i><span>Logout</span>
                                                    </button>
                                                </form>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="min-h-screen">
        <main role="main" class="items-center pb-3">
            @RenderBody()
        </main>
    </div>
    <footer class="py-12 theme-card theme-text border-t theme-line transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <div class="text-2xl font-bold mb-4">Handwooven</div>
                    <p class="opacity-70">Gieo hồn việt, đan nét quê.</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Services</h4>
                    <ul class="space-y-2 opacity-80">
                        <li><a href="#" class="hover:opacity-100">—</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Company</h4>
                    <ul class="space-y-2 opacity-80">
                        <li><a href="#" class="hover:opacity-100">About Us</a></li>
                        <li><a href="#" class="hover:opacity-100">Careers</a></li>
                        <li><a href="#" class="hover:opacity-100">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Support</h4>
                    <ul class="space-y-2 opacity-80">
                        <li><a href="#" class="hover:opacity-100">Help Center</a></li>
                        <li><a href="#" class="hover:opacity-100">Community</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t theme-line mt-8 pt-8 text-center opacity-60">
                <p>&copy; 2025 Handwooven. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    @{
        var returnUrl = Context?.Request?.Path + Context?.Request?.QueryString;
    }

    <!-- Sign In Modal -->
<div id="authModal" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center hidden">
  <div class="bg-[#1a1e24] text-white rounded-xl shadow-xl w-full max-w-md p-8 relative mx-4">
    <button onclick="closeModal()" class="absolute top-4 right-5 text-gray-400 hover:text-white text-2xl">
      <i class="fas fa-times"></i>
    </button>

    <div class="text-center mb-6">
      <div class="flex items-center justify-center gap-2 text-2xl font-bold">
        <i class="fas fa-star text-white"></i>
        <span class="text-green-400">Sign in</span>
      </div>
    </div>

    <div class="flex gap-4 mb-6">
      <!-- Google -->
      <form id="external-account" method="post"
            action="/Identity/Account/ExternalLogin" class="flex w-1/2">
        @Html.AntiForgeryToken()
        <input type="hidden" name="returnUrl" value="@returnUrl" />
        <button type="submit" name="provider" value="Google"
                class="flex w-full items-center justify-center gap-2.5 rounded-lg p-3.5 text-white bg-gray-800 hover:bg-gray-700 transition">
          <span>Sign In</span>
          <!-- icon Google -->
          <svg width="23" height="22" viewBox="0 0 23 22" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_709_8846)">
              <path d="M22.5001 11.2438C22.5134 10.4876 22.4338 9.73256 22.2629 8.995H11.7246V13.0771H17.9105C17.7933 13.7929 17.5296 14.478 17.1352 15.0914C16.7409 15.7047 16.224 16.2335 15.6158 16.646L15.5942 16.7827L18.9264 19.3124L19.1571 19.335C21.2772 17.4161 22.4997 14.5926 22.4997 11.2438" fill="#4285F4"></path>
              <path d="M11.7245 22C14.755 22 17.2992 21.0221 19.1577 19.3355L15.6156 16.6464C14.6679 17.2944 13.3958 17.7467 11.7245 17.7467C10.3051 17.7385 8.92433 17.2926 7.77814 16.472C6.63195 15.6515 5.77851 14.4981 5.33892 13.1755L5.20737 13.1865L1.74255 15.8142L1.69727 15.9376C2.63043 17.7602 4.06252 19.2925 5.83341 20.3631C7.60429 21.4337 9.64416 22.0005 11.7249 22" fill="#34A853"></path>
              <path d="M5.33889 13.1755C5.09338 12.4753 4.96669 11.7404 4.96388 11C4.9684 10.2608 5.09041 9.52685 5.32552 8.8245L5.31927 8.67868L1.81196 6.00867L1.69724 6.06214C0.910039 7.5938 0.5 9.28491 0.5 10.9999C0.5 12.7148 0.910039 14.406 1.69724 15.9376L5.33889 13.1755Z" fill="#FBBC05"></path>
              <path d="M11.7249 4.25337C13.3333 4.22889 14.8888 4.8159 16.065 5.89121L19.2329 2.86003C17.2011 0.992106 14.5106 -0.0328008 11.7249 3.27798e-05C9.64418 -0.000452376 7.60433 0.566279 5.83345 1.63686C4.06256 2.70743 2.63046 4.23965 1.69727 6.06218L5.32684 8.82455C5.77077 7.50213 6.62703 6.34962 7.77491 5.5295C8.9228 4.70938 10.3044 4.26302 11.7249 4.25337Z" fill="#EB4335"></path>
            </g>
            <defs><clipPath id="clip0_709_8846"><rect width="22" height="22" fill="white" transform="translate(0.5)"></rect></clipPath></defs>
          </svg>
        </button>
      </form>
      <!-- GitHub -->
      <form method="post" action="/Identity/Account/ExternalLogin" class="flex w-1/2">
        @Html.AntiForgeryToken()
        <input type="hidden" name="returnUrl" value="@returnUrl" />
        <button type="submit" name="provider" value="GitHub"
                class="flex w-full items-center justify-center gap-2.5 rounded-lg p-3.5 text-white bg-gray-800 hover:bg-gray-700 transition">
          <span>Sign In</span>
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M12 0.297546C5.37 0.297546 0 5.66755 0 12.2975C0 17.6075 3.438 22.0975 8.205 23.7975C8.805 23.8975 9.025 23.5475 9.025 23.2475C9.025 22.9975 9.015 22.2975 9.01 21.2975C5.672 21.9975 4.968 19.6975 4.968 19.6975C4.422 18.2975 3.633 17.9475 3.633 17.9475C2.545 17.2475 3.717 17.2625 3.717 17.2625C4.922 17.3475 5.555 18.4975 5.555 18.4975C6.632 20.2975 8.368 19.7975 9.048 19.4975C9.148 18.6975 9.455 18.1475 9.795 17.8475C7.145 17.5475 4.343 16.4975 4.343 11.7975C4.343 10.4475 4.8 9.34755 5.585 8.49755C5.46 8.19755 5.055 6.92255 5.7 5.19755C5.7 5.19755 6.735 4.87255 9.005 6.29755C9.985 6.02255 11.035 5.88555 12.085 5.88055C13.135 5.88555 14.185 6.02255 15.165 6.29755C17.435 4.87255 18.47 5.19755 18.47 5.19755C19.115 6.92255 18.71 8.19755 18.585 8.49755C19.37 9.34755 19.825 10.4475 19.825 11.7975C19.825 16.5075 17.02 17.5425 14.36 17.8375C14.78 18.2075 15.165 18.9475 15.165 20.0975C15.165 21.7475 15.15 22.9275 15.15 23.2475C15.15 23.5475 15.37 23.9025 15.975 23.7975C20.735 22.0975 24.165 17.6075 24.165 12.2975C24.165 5.66755 18.795 0.297546 12 0.297546Z" />
          </svg>
        </button>
      </form>
    </div>

    <div class="flex items-center gap-2 text-gray-500 text-sm mb-6">
      <div class="flex-1 border-t border-gray-700"></div> OR
      <div class="flex-1 border-t border-gray-700"></div>
    </div>

    <!-- Login form cũ (nếu bạn dùng controller riêng) -->
    <form method="post" action="/Authentication/Login" class="space-y-4">
      <input type="email" name="Email" placeholder="Email" class="w-full bg-[#2b2f36] text-white border border-gray-600 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
      <input type="password" name="Password" placeholder="Password" class="w-full bg-[#2b2f36] text-white border border-gray-600 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
      <button type="submit" class="w-full bg-green-400 text-black font-semibold py-3 rounded-lg hover:bg-green-500 transition">Sign In</button>
    </form>

    <div class="mt-6 text-sm text-center text-gray-400">
      Chưa có tài khoản?
      <a onclick="changeToSignUp()" class="text-green-400 font-medium cursor-pointer hover:underline">Sign Up</a>
    </div>
  </div>
</div>

<!-- Sign Up Modal (bản bạn gửi) -->
<div id="signUpModal" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center hidden">
  <div class="bg-[#1a1e24] text-white rounded-xl shadow-xl w-full max-w-md p-8 relative mx-4">
    <button onclick="closeSignUpModal()" class="absolute top-4 right-5 text-gray-400 hover:text-white text-2xl">
      <i class="fas fa-times"></i>
    </button>

    <div class="text-center mb-6">
      <div class="flex items-center justify-center gap-2 text-2xl font-bold">
        <i class="fas fa-user-plus text-white"></i>
        <span class="text-green-400">Sign Up</span>
      </div>
      <p class="text-gray-400 text-sm mt-2">Create your account to get started</p>
    </div>

    <form class="space-y-4" method="post" action="/Authentication/Register">
      <input type="text" id="fullName" name="FullName" placeholder="Full Name" required
             class="w-full bg-[#2b2f36] text-white border border-gray-600 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent" />
      <input type="email" id="email" name="Email" placeholder="Email Address" required
             class="w-full bg-[#2b2f36] text-white border border-gray-600 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent" />
      <input type="password" id="password" name="Password" placeholder="Password" required
             class="w-full bg-[#2b2f36] text-white border border-gray-600 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent" />
      <input type="password" id="confirmPassword" name="ConfirmPassword" placeholder="Confirm Password" required
             class="w-full bg-[#2b2f36] text-white border border-gray-600 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent" />

      <div class="flex items-center">
        <input type="checkbox" id="terms" required class="mr-2 text-green-400">
        <label for="terms" class="text-sm text-gray-400">
          I agree to the <a href="#" class="text-green-400 hover:underline">Terms of Service</a> and
          <a href="#" class="text-green-400 hover:underline">Privacy Policy</a>
        </label>
      </div>

      <button type="submit" class="w-full bg-green-400 text-black font-semibold py-3 rounded-lg hover:bg-green-500 transition duration-200">
        Create Account
      </button>
    </form>

    <div class="flex items-center gap-2 text-gray-500 text-sm mb-3 mt-3">
      <div class="flex-1 border-t border-gray-700"></div> OR
      <div class="flex-1 border-t border-gray-700"></div>
    </div>

    <div class="flex gap-4 mb-6">
      <!-- Google -->
      <form id="external-account" method="post"
            action="/Identity/Account/ExternalLogin" class="flex w-1/2">
        @Html.AntiForgeryToken()
        <input type="hidden" name="returnUrl" value="@returnUrl" />
        <button type="submit" name="provider" value="Google"
                class="flex w-full items-center justify-center gap-2.5 rounded-lg p-3.5 text-white bg-gray-800 hover:bg-gray-700 transition">
          <span>Sign In</span>
          <!-- icon Google (giữ nguyên của bạn) -->
          <svg width="23" height="22" viewBox="0 0 23 22" fill="none" xmlns="http://www.w3.org/2000/svg">…</svg>
        </button>
      </form>
      <!-- GitHub -->
      <form method="post" action="/Identity/Account/ExternalLogin" class="flex w-1/2">
        @Html.AntiForgeryToken()
        <input type="hidden" name="returnUrl" value="@returnUrl" />
        <button type="submit" name="provider" value="GitHub"
                class="flex w-full items-center justify-center gap-2.5 rounded-lg p-3.5 text-white bg-gray-800 hover:bg-gray-700 transition">
          <span>Sign In</span>
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">…</svg>
        </button>
      </form>
    </div>

    <div class="mt-6 text-sm text-center text-gray-400">
      Already have an account?
      <a onclick="changeToSignIn()" class="text-green-400 font-medium cursor-pointer hover:underline">Sign In</a>
    </div>
  </div>
</div>
    @{
        var notify = ViewBag.Notification as Notification;
    }
    @if (notify != null)
    {
        <partial name="_Notification" model="notify" />
    }


    <partial name="_Notification" model="notify" />
    <script src="~/lib//jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script>
      function openModal(){ document.getElementById('authModal')?.classList.remove('hidden'); document.body.classList.add('modal-open'); }
      function closeModal(){ document.getElementById('authModal')?.classList.add('hidden'); document.body.classList.remove('modal-open'); }
      function openSignUpModal(){ document.getElementById('signUpModal')?.classList.remove('hidden'); document.body.classList.add('modal-open'); }
      function closeSignUpModal(){ document.getElementById('signUpModal')?.classList.add('hidden'); document.body.classList.remove('modal-open'); }
      function changeToSignUp(){ closeModal(); openSignUpModal(); }
      function changeToSignIn(){ closeSignUpModal(); openModal(); }
      // đóng bằng ESC
      document.addEventListener('keydown', e => { if(e.key==='Escape'){ closeModal(); closeSignUpModal(); }});
    </script>
    <script>
        const mobileMenuBtn = document.querySelector('[aria-controls="mobile-menu"]');
        if (mobileMenuBtn) {
          const mobileMenu = document.getElementById('mobile-menu');
          const openIcon = mobileMenuBtn.querySelector('svg.block');
          const closeIcon = mobileMenuBtn.querySelector('svg.hidden');
          mobileMenuBtn.addEventListener('click', () => {
            const isHidden = mobileMenu.classList.toggle('hidden');
            openIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('hidden');
            mobileMenuBtn.setAttribute('aria-expanded', !isHidden);
          });
        }
    </script>
    <script>
                // Popover functionality
        const userButton = document.getElementById('userButton');
        const popover = document.getElementById('popover');
        let isPopoverVisible = false;

        // Toggle popover
        function togglePopover() {
            if (isPopoverVisible) {
                hidePopover();
            } else {
                showPopover();
            }
        }

        // Show popover
        function showPopover() {
            popover.classList.remove('opacity-0', 'invisible', 'scale-95');
            popover.classList.add('opacity-100', 'visible', 'scale-100');
            isPopoverVisible = true;
        }

        // Hide popover
        function hidePopover() {
            popover.classList.remove('opacity-100', 'visible', 'scale-100');
            popover.classList.add('opacity-0', 'invisible', 'scale-95');
            isPopoverVisible = false;
        }

        // Event listeners
        if (userButton) {
            userButton.addEventListener('click', togglePopover);
        }
        // Close popover when clicking outside
        document.addEventListener('click', function (event) {
            const userButton = document.getElementById('userButton');
            const popover = document.getElementById('popover');

            if (userButton && popover &&
                !userButton.contains(event.target) &&
                !popover.contains(event.target)) {
                hidePopover();
            }
        });
        // Close popover on ESC key
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape' && isPopoverVisible) {
                hidePopover();
            }
        });

    </script>
    <script>
        const key='theme', html=document.documentElement;
        const saved = localStorage.getItem(key);
        if (saved) html.classList.toggle('dark', saved==='dark');
        document.getElementById('toggleDark')?.addEventListener('click',()=>{
          const isDark = html.classList.toggle('dark');
          localStorage.setItem(key, isDark ? 'dark' : 'light');
        });
    </script>
</body>
</html>
