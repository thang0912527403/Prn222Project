@using Prn222Project.Models
@using Prn222Project.ViewModels
@model HomePageVM

@{
    ViewData["Title"] = "Trang chủ";
    var cats = Model?.Categories ?? new List<Category>();
    var featured = Model?.Featured ?? new List<Product>();
    var best = Model?.BestSellers ?? new List<Product>();
    var more = Model?.MoreProducts ?? new List<Product>();
}

<!-- HERO -->
<section class="section">
    <div class="max-w-7xl mx-auto px-4">
        <div class="hero-green ring-hero hero-pad rounded-2xl overflow-hidden">
            <div class="hero-inner">
                <!-- Cột trái -->
                <div class="text-white">
                    <div class="flex gap-2 mb-6">
                        <span class="badge-light">🌿 ThủCôngMâyTre</span>
                        <span class="badge-light">🍃 ECO SALE</span>
                    </div>

                    <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
                        SẢN PHẨM MÂY TRE<br />
                        THỦ CÔNG ——<br />
                        <span class="text-accent">GIẢM GIÁ SỐC</span>
                    </h1>

                    <p class="mt-3 text-lg font-semibold text-emerald-100">🎋 Ưu đãi đang diễn ra</p>

                    <!-- Danh mục: nằm ngang từ >=sm -->
                    <div class="hero-cat-grid mt-4 max-w-xl">
                        @if (Model?.Categories?.Any() ?? false)
                        {
                            @foreach (var c in Model.Categories.Take(3))
                            {
                                <a href="/products?categories=@c.Id" class="hero-cat">
                                    <div class="icon-badge">🧺</div>
                                    <div class="mt-2 font-semibold">@c.Name</div>
                                    <div class="kicker">Khám phá</div>
                                </a>
                            }
                        }
                        else
                        {
                            <div class="col-span-full text-emerald-50/90 p-3 rounded-xl border border-white/30">
                                Chưa có danh mục.
                            </div>
                        }
                    </div>

                    <a href="/products"
                       class="btn-white inline-flex items-center px-7 py-3 rounded-full font-bold mt-5">
                        🛒 MUA NGAY - GIẢM 50%
                    </a>
                </div>

                <!-- Cột phải (mockup featured) -->
                <aside class="phone-card floating w-full max-w-md">
                    @foreach (var f in (Model?.Featured ?? new List<Prn222Project.Models.Product>()).Take(3))
                    {
                        <a href="/Product/Details/@f.Id" class="phone-row">
                            <img src="@(string.IsNullOrEmpty(f.ImageUrl) ? Url.Content("~/images/no-image.jpg") : f.ImageUrl)"
                                 alt="@f.Name" />
                            <div class="flex-1 min-w-0">
                                <div class="truncate font-semibold text-gray-800 text-sm">@f.Name</div>
                                <div class="text-xs font-bold text-green-700 mt-0.5">💰 @f.Price.ToString("N0") đ</div>
                            </div>
                        </a>
                    }
                    @if (!(Model?.Featured?.Any() ?? false))
                    {
                        <div class="opacity-70 text-sm">Chưa có sản phẩm nổi bật.</div>
                    }

                    <div class="text-center pt-2">
                        <a href="/products" class="px-5 py-2 rounded-full text-sm font-bold btn-primary">
                            📱 XEM SHOP
                        </a>
                    </div>
                </aside>
            </div>
        </div>
    </div>
</section>


<!-- DANH MỤC -->
<section class="section">
    <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-center text-2xl font-bold mb-6">📁 DANH MỤC SẢN PHẨM</h2>

        <div class="grid md:grid-cols-2 gap-5">
            @if (cats.Any())
            {
                @foreach (var (c, i) in cats.Take(4).Select((c, i) => (c, i)))
                {
                    <a href="/products?categories=@c.Id" class="card p-4 theme-card theme-line flex items-center gap-4 hover:opacity-95">
                        <div class="text-4xl">🧺</div>
                        <div class="space-y-1">
                            <div class="flex items-center gap-3">
                                <span class="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold" style="background:var(--primary)">@(@i + 1)</span>
                                <h3 class="font-semibold">@c.Name</h3>
                            </div>
                            <p class="text-sm opacity-80">Khám phá các sản phẩm @c.Name.</p>
                        </div>
                    </a>
                }
            }
            else
            {
                <div class="col-span-full opacity-70">Chưa có danh mục.</div>
            }
        </div>
    </div>
</section>

<!-- BÁN CHẠY -->
<section class="section">
    <div class="max-w-7xl mx-auto px-4">
        <h3 class="text-center text-2xl font-bold mb-6">💵 SẢN PHẨM BÁN CHẠY</h3>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            @if (best.Any())
            {
                @foreach (var p in best)
                {
                    <a href="/Product/Details/@p.Id" class="block card theme-card theme-line p-3 hover:opacity-95">
                                <img class="w-full h-32 md:h-40 object-cover rounded-md"
                                       src="@(string.IsNullOrEmpty(p.ImageUrl) ? Url.Content("~/images/no-image.jpg") : p.ImageUrl)" alt="@p.Name" />
                                <div class="mt-3 font-semibold truncate">@p.Name</div>
                                <div class="mt-1 text-primary font-bold">@p.Price.ToString("N0") VNĐ</div>                      
                    </a>
                }
            }
            else
            {
                <div class="col-span-full text-center opacity-70 py-8">Chưa có sản phẩm.</div>
            }
        </div>
    </div>
</section>

<!-- NHIỀU SẢN PHẨM HƠN -->
<section class="section">
    <div class="max-w-7xl mx-auto px-4">
        <h3 class="text-center text-2xl font-bold mb-6">➕ Nhiều sản phẩm hơn</h3>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            @if (more.Any())
            {
                @foreach (var p in more)
                {
                    <a href="/Product/Details/@p.Id" class="block card theme-card theme-line p-3 hover:opacity-95">
                        <img class="w-full h-32 md:h-40 object-cover rounded-md"
                             src="@(string.IsNullOrEmpty(p.ImageUrl) ? Url.Content("~/images/no-image.jpg") : p.ImageUrl)"
                             alt="@p.Name" />
                        <div class="mt-3 font-semibold truncate">@p.Name</div>
                        <div class="mt-1 text-primary font-bold">@p.Price.ToString("N0") VNĐ</div>
                    </a>
                }
            }
            else
            {
                <div class="col-span-full text-center opacity-70 py-8">Chưa có thêm sản phẩm.</div>
            }
        </div>
    </div>
</section>
